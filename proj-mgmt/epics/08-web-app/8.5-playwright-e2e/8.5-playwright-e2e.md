# 8.5: Playwright E2E Tests

**Status:** IN PROGRESS
**Epic:** [Epic 8: Web Application](./_epic.md)
**Goal:** Create a Playwright test project that automates browser-based login via Entra ID, invokes MCP tools through the Blazor UI as each persona, and verifies that the identity passthrough architecture produces correct, persona-scoped results end-to-end.

**ADR:** [ADR-005](../../decisions/005-oauth-identity-passthrough.md), [ADR-006](../../decisions/006-web-app-architecture.md)

## Items

| ID | Title | Type | Status |
|---|---|---|---|
| [8.5.1](./8.5.1-e2e-test-project-setup.md) | E2E test project setup (`LawCorp.Mcp.Tests.E2E`) | Task | DONE |
| [8.5.2](./8.5.2-entra-login-automation.md) | Entra ID login automation (auth setup per persona) | Story | IN PROGRESS |
| [8.5.3](./8.5.3-persona-access-tests.md) | Persona-based access control test scripts | Story | BACKLOG |
| [8.5.4](./8.5.4-full-stack-audit-tests.md) | Full-stack audit verification tests | Story | BACKLOG |

## Test Strategy

```
auth.setup (runs once per persona)
  ├─ Navigate to Blazor app → Entra redirect → fill email/password → redirect back
  ├─ Save storageState to .auth/harvey-specter.json
  ├─ Save storageState to .auth/kim-wexler.json
  └─ ... (one per persona)

test suite (uses cached login state)
  ├─ Harvey Specter: invoke cases_search → assert all M&A cases visible
  ├─ Kim Wexler: invoke cases_search → assert only assigned cases visible
  ├─ Vinny Gambini: invoke cases_search → assert redacted content
  └─ Compare results across personas → identity passthrough verified
```

## Acceptance Criteria

- [ ] `LawCorp.Mcp.Tests.E2E` project exists with Playwright configured
- [ ] Auth setup automates Entra ID login for all six personas and caches login state
- [ ] At least one test per persona verifies correct access scoping for `cases_search`
- [ ] Tests assert that Harvey sees more cases than Kim, Kim sees more than Vinny, etc.
- [ ] Full-stack audit tests verify that the MCP server's authorization decisions match the UI results
- [ ] Tests can run in CI with `[Trait("Category", "E2E")]` gating
- [ ] Test scripts are structured to be reusable when the Angular and React companion apps are built

## Dependencies

- 8.1–8.3 (Blazor web app) — the app must be functional with auth and MCP tools
- 7.2 (persona fixture) — persona definitions and seeded data
- Epic 1 (auth) — Entra ID app registrations must be configured with test users
