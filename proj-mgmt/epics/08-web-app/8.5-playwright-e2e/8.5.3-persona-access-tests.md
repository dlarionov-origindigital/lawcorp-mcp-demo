# 8.5.3: Persona-based access control test scripts

**Status:** BACKLOG
**Type:** Story
**Feature:** [8.5: Playwright E2E Tests](./8.5-playwright-e2e.md)
**Tags:** `+web-app` `+testing` `+auth` `+e2e`

---

As a QA engineer verifying the identity passthrough architecture,
I want automated Playwright tests that log in as each persona and verify they see different data,
So that I can confirm the core value proposition: "the MCP server can only do what the logged-in user can do."

## Test Scenarios

### Case search scoping

| # | Persona | Action | Expected Result |
|---|---|---|---|
| 1 | Harvey Specter (Partner) | Invoke `cases_search` | All M&A cases visible (Alpha, Beta) |
| 2 | Kim Wexler (Associate) | Invoke `cases_search` | Only assigned cases (Alpha) |
| 3 | Alan Shore (OfCounsel) | Invoke `cases_search` | Only Securities cases (Gamma) |
| 4 | Erin Brockovich (Paralegal) | Invoke `cases_search` | Only assigned cases (Alpha) |
| 5 | Elle Woods (LegalAssistant) | Invoke `cases_search` | Harvey's cases (Alpha, Beta) |
| 6 | Vinny Gambini (Intern) | Invoke `cases_search` | Assigned cases only (Alpha) |

### Cross-persona comparison

| # | Assertion |
|---|---|
| 7 | Harvey sees more cases than Kim |
| 8 | Kim sees more cases than Vinny |
| 9 | Alan sees cases that Harvey does not (cross-practice group) |
| 10 | Vinny's case results contain redacted content where Harvey's do not |

### Billing access

| # | Persona | Action | Expected Result |
|---|---|---|---|
| 11 | Harvey Specter | Invoke billing tool | Full billing data visible |
| 12 | Erin Brockovich | Invoke billing tool | Access denied or empty result |
| 13 | Vinny Gambini | Invoke billing tool | Access denied or empty result |

## Implementation Steps

- [ ] Create `PersonaAccessTests.cs` with parameterized tests using `[Theory]` and `[MemberData]` providing persona name + storage state path
- [ ] Each test:
  1. Creates a new Playwright browser context with the persona's storage state
  2. Navigates to the Tools page (`/tools`)
  3. Selects the target tool (e.g., `cases_search`)
  4. Fills in parameters and clicks Invoke
  5. Asserts on the visible results (count, content, presence/absence of specific data)
- [ ] Cross-persona comparison tests run all personas, collect results, and assert relative ordering
- [ ] Redaction tests compare Harvey's and Vinny's views of the same document to verify content differences

## Acceptance Criteria

- [ ] All 13 test scenarios pass
- [ ] Tests are parameterized by persona — adding a new persona requires only adding data, not new test methods
- [ ] Each test runs in < 30 seconds (excluding auth setup)
- [ ] Test failures include screenshots and the MCP trace for debugging
- [ ] Tests use Page Object Model or similar abstraction for Blazor page interactions

## Dependencies

- 8.5.2 (auth setup) — storage state files must exist
- 8.2.3 (tool invocation UI) — the UI must be functional
- 7.2 (persona fixture) — seeded test data must be in place
