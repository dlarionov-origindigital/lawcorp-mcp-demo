# 8.3.2: MCP message trace viewer (JSON-RPC debug)

**Status:** BACKLOG
**Type:** Story
**Feature:** [8.3: Authorization Audit & Observability](./8.3-auth-audit-observability.md)
**Tags:** `+web-app` `+mcp-client` `+ui`

---

As a developer or tester,
I want to see the raw MCP JSON-RPC messages exchanged between the web app and the MCP server,
So that I can debug protocol issues and verify that the correct requests are being sent.

## Implementation Steps

- [ ] Create an `McpTrace.razor` page at `/trace` (or a collapsible panel on the tools page)
- [ ] Intercept MCP messages at the transport layer:
  - Option A: Wrap `HttpClientTransport` with a delegating handler that logs request/response bodies
  - Option B: Use the MCP SDK's logging/event hooks if available
- [ ] Display each message as a collapsible card:
  - Direction (outbound request / inbound response)
  - Timestamp
  - JSON-RPC method name (e.g., `tools/call`, `tools/list`)
  - Full JSON body (syntax-highlighted, collapsible)
  - HTTP status code and headers (including `Authorization: Bearer <redacted>`)
- [ ] Allow filtering by method name and searching within message bodies
- [ ] Auto-scroll to latest messages with a pause/resume toggle
- [ ] Redact the Bearer token value in the display (show `Bearer •••••` with a "reveal" toggle)

## Acceptance Criteria

- [ ] Every MCP request and response is captured and displayed in the trace viewer
- [ ] JSON bodies are syntax-highlighted and collapsible
- [ ] Bearer tokens are redacted by default
- [ ] The trace viewer does not impact MCP performance noticeably (buffering, not blocking)
- [ ] The trace persists for the current session and can be cleared

## Notes

This is the "educational" feature — it makes the MCP protocol tangible for developers evaluating the reference architecture. Think of it as a built-in mini-Fiddler for MCP traffic.
