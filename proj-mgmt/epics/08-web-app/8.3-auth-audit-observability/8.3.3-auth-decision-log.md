# 8.3.3: Authorization decision log viewer

**Status:** BACKLOG
**Type:** Story
**Feature:** [8.3: Authorization Audit & Observability](./8.3-auth-audit-observability.md)
**Tags:** `+web-app` `+auth` `+ui`

---

As a stakeholder evaluating the access control model,
I want to see a log of authorization decisions — what access was granted, what was denied, and why,
So that I can verify the identity passthrough is working correctly without reading server logs.

## Implementation Steps

- [ ] Define a structured authorization event model that the MCP server emits:
  - User identity (name, role)
  - Tool/resource invoked
  - Decision (Granted / Denied / Filtered / Redacted)
  - Reason (e.g., "Row-level filter: user not assigned to case", "Role insufficient: requires Partner")
  - Timestamp
- [ ] Add an endpoint on the MCP server (or a sidecar) that streams authorization events:
  - Option A: SSE endpoint at `/api/audit-stream` on the MCP server
  - Option B: Include authorization metadata in the MCP tool response (custom extension field)
  - Option C: Poll the `AuditLog` table from the Blazor app via a direct DB read (simplest for the reference architecture)
- [ ] Create an `AuditLog.razor` page at `/audit` displaying authorization events as a filterable table:
  - Columns: Timestamp, User, Tool/Resource, Decision, Reason
  - Filters: by user, by decision type, by tool
  - Color-coded: green for granted, red for denied, yellow for filtered/redacted
- [ ] Cross-link from the tool invocation result (8.2.3) to the corresponding audit entry

## Acceptance Criteria

- [ ] Authorization decisions from the MCP server are visible in the web app
- [ ] The log shows both granted and denied access for the current user's session
- [ ] A non-developer can look at the log and understand "Kim was denied billing access because she's an Associate"
- [ ] Audit entries correlate with the MCP tool invocations in the trace viewer

## Dependencies

- 1.3.4 (audit logging) — the MCP server must emit structured audit events
- 8.3.2 (trace viewer) — for cross-referencing
