# 8.2.6: Role-scoped tool discovery page

**Status:** BACKLOG
**Type:** Story
**Feature:** [8.2: MCP Client Integration](./8.2-mcp-client-integration.md)
**Tags:** `+web-app` `+rbac` `+mcp-client` `+obo-validation`
**ADR:** [ADR-005](../../decisions/005-oauth-identity-passthrough.md)

---

As a Law-Corp user,
I want to see the tools available to my role when I sign in,
So that I can confirm my identity is correctly recognized and only role-appropriate capabilities are exposed to me.

## Context

This is the **first end-to-end validation of the OBO identity passthrough chain** ([ADR-005](../../decisions/005-oauth-identity-passthrough.md)). When Harvey Specter (Partner) signs in, he should see all 35 tools. When an Intern signs in, they see a much smaller set. The difference proves that:

1. The Blazor app is attaching the user's access token to the MCP request (8.2.2)
2. The MCP server is resolving `IFirmIdentityContext` from that token (1.3.5)
3. The server is applying the tool permission matrix to filter `tools/list` (1.3.6)

This story is intentionally **simpler than [8.2.3](./8.2.3-tool-invocation-ui.md)** — no invocation forms, no result panels, no history. It is a pure discovery and identity-validation surface. Its purpose is to make the RBAC visible and verifiable before the full tool invocation UI is built.

## Implementation Steps

- [ ] Create a `MyTools.razor` page at `/my-tools`
- [ ] On page load, call `IMcpClientService.ListToolsAsync()` — the server returns only tools permitted for the authenticated user's role
- [ ] Display the current user's resolved identity at the top of the page: **name**, **role badge** (e.g., "Partner"), and **practice group** — sourced from the Blazor auth state (claims on the OIDC token)
- [ ] Display a summary line: **"You have access to X of 35 tools"** — makes RBAC immediately visible; the number differs per role
- [ ] Group the returned tools by domain using Fluent UI `FluentAccordion` sections: Cases, Documents, Clients & Contacts, Billing, Calendar, Research, Intake
- [ ] Each tool entry shows: tool name (monospace) and description
- [ ] Domains with zero permitted tools for this role are shown as a collapsed section labeled "No access" — the absence is explicit, not hidden
- [ ] Show a loading state while `ListToolsAsync()` is in flight
- [ ] If `ListToolsAsync()` fails (token expired, server unreachable), display a clear inline error with guidance — no unhandled exceptions

## Acceptance Criteria

- [ ] Harvey Specter (Partner) sees all 35 tools, the "Partner" role badge, and the summary reads "35 of 35 tools"
- [ ] An Intern persona sees only their permitted tools (research and read-only case/document tools); Billing and Intake sections show "No access"
- [ ] Two concurrent sessions with different roles show different tool counts, confirming session token isolation (8.2.2)
- [ ] The role badge is sourced from the token resolved server-side — it reflects the database role, not a claim the user could alter
- [ ] Page renders without error when the server returns an empty tool list (edge case for a role with no tools)

## Dependencies

- 8.2.1 (MCP client service) — `IMcpClientService.ListToolsAsync()` must be implemented
- 8.2.2 (token passthrough) — the user's Bearer token must reach the MCP server on every request
- 1.3.6 (tool permission matrix) — the server must filter `tools/list` by role; without this, all users see the same tools and this page is not meaningful
- 1.3.5 (`IFirmIdentityContext`) — server must resolve identity from the token to apply the matrix

## Notes

This page is the **smoke test for the OBO flow**. Playwright E2E tests (8.5) should assert on this page for each persona — checking role badge text and tool count — before any invocation tests in 8.2.3 are run.

Intentionally no "Invoke" button here. The separation keeps this story fast to implement and fast to verify. Full invocation UI lives in 8.2.3.

The `/my-tools` path is separate from the full tool invocation UI at `/tools` (8.2.3). Both pages call `ListToolsAsync()` and will show the same filtered list; `/my-tools` is the simpler diagnostic surface.
