# 8.2.1: MCP client service with HttpClientTransport

**Status:** DONE
**Type:** Story
**Feature:** [8.2: MCP Client Integration](./8.2-mcp-client-integration.md)
**Tags:** `+web-app` `+mcp-client`

---

As a developer building the Blazor web app,
I want a reusable MCP client service that connects to the Law-Corp MCP server via HTTP,
So that all Blazor components can invoke tools, read resources, and use prompts through a shared abstraction.

## Implementation Steps

- [x] Create `IMcpClientService` interface in the web app project with methods:
  - `Task<IList<McpClientTool>> ListToolsAsync()`
  - `Task<CallToolResult> CallToolAsync(string toolName, Dictionary<string, object?> arguments)`
  - `McpClientState State { get; }` (Connecting, Ready, Failed)
  - Resource and prompt methods deferred to 8.2.4 and 8.2.5 respectively
- [x] Implement `McpClientService : IMcpClientService` using:
  - `HttpClientTransport` with configurable endpoint URL (`McpServer:Endpoint` config key)
  - `McpClient.CreateAsync(transport)` to establish the connection
  - Lazy initialization with double-check locking
- [x] Register `IMcpClientService` as **scoped** in DI (one per user session in Interactive Server mode)
- [x] Add configuration section to `appsettings.json`:
  ```json
  { "McpServer": { "Endpoint": "http://localhost:5000/mcp" } }
  ```
- [ ] Add health check: verify MCP server is reachable on startup or first connection attempt (deferred)
- [ ] Automatic reconnection on transport failure (deferred)

## Acceptance Criteria

- [x] `IMcpClientService` can list tools from the connected MCP server
- [x] `CallToolAsync` returns the MCP server's response for a valid tool call
- [x] Connection failures produce a clear error state (not an unhandled exception)
- [ ] The service reconnects automatically if the transport drops (deferred)

## Notes

Token passthrough is handled in [8.2.2](./8.2.2-session-token-passthrough.md). This task establishes the transport plumbing; 8.2.2 adds the auth header.
