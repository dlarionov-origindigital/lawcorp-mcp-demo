# 8.1.2: Entra ID OIDC Sign-In

**Status:** IN PROGRESS
**Type:** Story
**Feature:** [8.1: Blazor Project Foundation](../8.1-blazor-project-foundation.md)
**Tags:** `+web-app` `+auth` `+core-flow`

---

As a Law-Corp user opening the web app,
I want to sign in with my corporate Entra ID account and see my identity reflected in the UI,
So that my access token can be passed to the MCP server and I can verify my authorization context.

This is the **core happy-path sign-in flow** — the single most important user journey in the web app. Every downstream feature (tool invocation, resource browsing, audit trails) depends on a properly established authenticated session.

## Happy Path

```
1. User visits https://localhost:5001
2. Home page loads → header shows "Sign in" button, home page shows "Not signed in"
3. User clicks "Sign in" → OIDC redirect to Entra ID login page
4. User enters credentials → Entra ID validates, issues tokens
5. Redirect back to app with session cookie established
6. Home page shows identity card: display name, role badge, email
7. Header shows persona avatar, name, role, and "Sign out" button
8. User clicks "Sign out" → session cleared, redirected to Entra ID sign-out, back to app
```

## Tasks

| ID | Title | Type | Status |
|---|---|---|---|
| [8.1.2.1](./8.1.2.1-oidc-program-config.md) | OIDC middleware and service configuration in Program.cs | Task | DONE |
| [8.1.2.2](./8.1.2.2-sign-in-flow.md) | Sign-in redirect flow (LoginDisplay → Entra ID → callback) | Task | DONE |
| [8.1.2.3](./8.1.2.3-sign-out-flow.md) | Sign-out flow (session clear → Entra ID sign-out → home) | Task | DONE |
| [8.1.2.4](./8.1.2.4-identity-display.md) | Identity display (home page card, header persona) | Task | DONE |
| [8.1.2.5](./8.1.2.5-claims-debug-page.md) | Claims debug page (/account/claims) | Task | DONE |
| [8.1.2.6](./8.1.2.6-anonymous-demo-mode.md) | Anonymous demo mode (UseAuth=false graceful fallback) | Task | DONE |

## Acceptance Criteria

- [ ] When `UseAuth=true`, clicking "Sign in" redirects to Entra ID and returns with a valid session
- [ ] After sign-in, the home page displays the user's display name, role, and email from JWT claims
- [ ] The header `LoginDisplay` shows a persona avatar, name, role badge, and "Sign out" button
- [ ] Sign-out clears the session and redirects through Entra ID sign-out
- [ ] `/account/claims` page shows all JWT claims for debugging token contents
- [ ] When `UseAuth=false`, all pages load without error; header shows "Demo mode" badge; no dead links
- [ ] `appsettings.json` (committed) contains empty placeholders; real values are in gitignored `appsettings.Development.json`
- [ ] `appsettings.Development.json.example` documents all required web app auth settings

## Dependencies

- Azure app registration with OIDC redirect URI `https://localhost:5001/signin-oidc` — see [8.1.4](../8.1.4-app-registration-redirect-uri.md)
- Docs: [auth-config.md](../../../../docs/auth-config.md) updated with web app setup section
- Docs: [local-mcp-inspect-auth.md](../../../../docs/local-mcp-inspect-auth.md) updated with web app testing section

## Related

- **Bug fixed:** [BUG-001](../8.6-header-links/BUG-001-sign-in-link-404.md) — sign-in link 404 when `UseAuth=false`
- **Header story:** [8.6.1](../8.6-header-links/8.6.1-sign-in-link-navigation.md) — sign-in link navigation E2E coverage

## Notes

The token acquired during OIDC sign-in is used in [8.2.2](../8.2.2-session-token-passthrough.md) to connect to the MCP server on behalf of the user.
