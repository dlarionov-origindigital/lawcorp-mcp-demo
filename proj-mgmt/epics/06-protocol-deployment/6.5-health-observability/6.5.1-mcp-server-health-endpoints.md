# 6.5.1: MCP Server Health Endpoints

**Status:** IN PROGRESS
**Type:** Story
**Feature:** [6.5 Health Checks & Observability](./6.5-health-observability.md)

## Goal

Add ASP.NET Core health check endpoints to the MCP Server so Azure App Service and load balancers can monitor instance health, and a future health dashboard can aggregate service status.

## Acceptance Criteria

- [x] `AddHealthChecks()` registered in `ServerBootstrap.RunHttpAsync()`
- [x] `/api/health` endpoint returns 200 OK with JSON body (liveness — process is alive)
- [x] Health endpoint is unauthenticated (`.AllowAnonymous()`)
- [x] Health endpoint returns structured JSON (`status`, `service`, `checks[]`)
- [x] Only registered in HTTP transport mode (stdio has no HTTP pipeline)
- [ ] `/api/health/ready` endpoint checks SQL Server (`LawCorpLocal`) connectivity
- [ ] `/api/health/ready` endpoint checks External API (`http://localhost:5002/health`) reachability
- [ ] Add tests for both healthy and unhealthy states

## Tasks

1. ~~Register `AddHealthChecks()` in `ServerBootstrap.RunHttpAsync()`~~ DONE
2. ~~Map `/api/health` liveness endpoint with custom JSON response writer~~ DONE
3. Add readiness probe at `/api/health/ready` with SQL Server and External API URI checks (requires `AspNetCore.HealthChecks.SqlServer` and `AspNetCore.HealthChecks.Uris` NuGet packages)
4. Add tests for both healthy and unhealthy states

## Path Convention

Health endpoints use the `/api/` prefix to stay consistent with the planned `/api/mcp` migration (6.5.3) and to clearly separate infrastructure endpoints from the MCP protocol surface.

| Endpoint | Purpose | Status |
|---|---|---|
| `/api/health` | Liveness (process alive) | DONE |
| `/api/health/ready` | Readiness (DB + External API reachable) | BACKLOG |

## References

- [Health checks in ASP.NET Core — Microsoft Learn](https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/health-checks)
- [Monitor App Service instances using health check — Microsoft Learn](https://learn.microsoft.com/en-us/azure/app-service/monitor-instances-health-check)
