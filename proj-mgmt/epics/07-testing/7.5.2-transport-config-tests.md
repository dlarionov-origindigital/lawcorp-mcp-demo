# 7.5.2: Transport configuration smoke tests

**Status:** BACKLOG
**Type:** Task
**Feature:** [7.5: Supplemental E2E Tests](./7.5-supplemental-e2e-tests.md)
**Tags:** `+testing` `+infrastructure`

---

Validate that the dual-transport configuration (see ADR-004) switches correctly between `http` and `stdio` modes, and that the Web API host exposes the correct MCP endpoint structure.

## Implementation Steps

- [ ] In `http` mode (the `LawCorpWebApplicationFactory` default): verify that a well-formed MCP `initialize` request to the HTTP transport endpoint returns a valid `InitializeResult` response
- [ ] Verify that unauthenticated requests to MCP tool endpoints return 401 (auth middleware is active in `http` mode)
- [ ] Verify that authenticated requests to MCP `tools/list` return the expected tool inventory (all tools registered in the server)
- [ ] In `stdio` mode (separate smoke test using a spawned process): verify that the server starts, writes the MCP init handshake to stdout, and responds to a minimal `initialize` JSON-RPC message â€” mark this test `[Trait("Category","E2E")]` as it requires process execution
- [ ] Verify that `Transport:Mode=unknown-value` at startup results in a startup exception (fail-fast)

## Acceptance Criteria

- [ ] HTTP mode MCP endpoint responds correctly to `initialize`
- [ ] `tools/list` returns the full tool catalog
- [ ] Unauthenticated MCP calls return 401
- [ ] stdio mode smoke test passes when run manually (not in CI by default)
- [ ] Invalid transport config causes startup failure with a clear error message
