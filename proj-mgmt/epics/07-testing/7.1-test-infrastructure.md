# 7.1: Test Infrastructure

**Status:** BACKLOG
**Epic:** [Epic 7: End-to-End Testing](./_epic.md)
**Goal:** Provide the shared plumbing — swappable DB provider, injectable identity context, and a `WebApplicationFactory` test host — that all other Epic 7 features build on.

## Items

| ID | Title | Type | Status |
|---|---|---|---|
| [7.1.1](./7.1.1-db-provider-adapter.md) | DB provider adapter | Task | BACKLOG |
| [7.1.2](./7.1.2-identity-context-abstraction.md) | `IFirmIdentityContext` test double | Task | BACKLOG |
| [7.1.3](./7.1.3-web-api-test-host.md) | Web API test host (`WebApplicationFactory`) | Task | BACKLOG |

## Acceptance Criteria

- [ ] `IDbProviderAdapter` (or equivalent) can be switched between SQLite in-memory, LocalDB, and real SQL via config without changing test code
- [ ] `FakeIdentityContext` can impersonate any of the six firm roles without requiring an Entra ID token
- [ ] `LawCorpWebApplicationFactory` boots the server in `http` mode against the in-memory DB within 2 seconds
- [ ] Each test class can receive a fresh or shared `WebApplicationFactory` instance without cross-test contamination

## Notes

Depends on story [1.3.5](../01-foundation/1.3.5-firm-identity-context.md) — `IFirmIdentityContext` must be defined in `LawCorp.Mcp.Core` or `LawCorp.Mcp.Server` before 7.1.2 can implement the test double.
