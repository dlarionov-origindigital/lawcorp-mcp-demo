# 7.2: Persona Fixture

**Status:** BACKLOG
**Epic:** [Epic 7: End-to-End Testing](./_epic.md)
**Goal:** Define a canonical set of six named personas (one per firm role) and a deterministic fixture seeder that creates a minimal, precisely-controlled dataset with known entity relationships, enabling authorization and access-control tests to make exact assertions — including identity passthrough scenarios for both Graph-backed and local DB-backed resources ([ADR-005](../../decisions/005-oauth-identity-passthrough.md)).

## Items

| ID | Title | Type | Status |
|---|---|---|---|
| [7.2.1](./7.2.1-persona-catalog.md) | Persona catalog | Task | BACKLOG |
| [7.2.2](./7.2.2-fixture-data-seeder.md) | Fixture data seeder | Task | BACKLOG |

## Design Rationale

The `PersonaFixture` is intentionally separate from the full `MockDataSeeder`. The mock seeder generates a large, realistic dataset for exploratory use; the fixture seeder creates a small, named, relationship-explicit dataset for test assertions. The fixture can later be replaced with a randomized but structurally equivalent generator if desired — the adapter pattern in 7.1.1 makes this swap transparent to the test classes.

The personas also serve as the identity source for **identity passthrough tests** (story [7.3.4](./7.3.4-identity-passthrough-tests.md)). Each persona has a defined set of expected Graph scopes and local DB access, enabling systematic verification that the same user identity produces correct results across both downstream patterns.

## Acceptance Criteria

- [ ] Six personas defined, one per role, with stable IDs
- [ ] Two cases seeded with controlled assignment relationships (see notes below)
- [ ] At least one privileged document exists on a shared case
- [ ] At least one invoice exists that only Partner and above can access
- [ ] Persona IDs in the fixture exactly match the IDs used by `FakeIdentityContext` in 7.1.2
- [ ] Fixture is idempotent — running the seeder twice does not create duplicates
- [ ] Each persona's expected downstream access scope (Graph + DB) is documented in the catalog

## Controlled Relationship Map

The fixture must establish the following relationships to enable the test scenarios in 7.3 and 7.4:

| Entity | Assigned to | Excluded from |
|---|---|---|
| **Case Alpha** (M&A practice group) | Harvey Specter (Lead), Kim Wexler (Supporting), Erin Brockovich (Paralegal) | Alan Shore, Elle Woods, Vinny Gambini |
| **Case Beta** (M&A practice group) | Harvey Specter (Lead) only | Kim Wexler, Erin Brockovich, Alan Shore, Elle Woods, Vinny Gambini |
| **Case Gamma** (Securities practice group) | Alan Shore (Of Counsel, read) | Harvey Specter, Kim Wexler, Erin Brockovich, Elle Woods, Vinny Gambini |
| **Privileged Document** on Case Alpha | Authored by Harvey Specter, `IsPrivileged=true` | Intern (Vinny Gambini) sees redacted version |
| **Invoice** on Case Alpha | Full access to Harvey Specter | Erin Brockovich, Elle Woods, Vinny Gambini have no access |
| Elle Woods | Legal Assistant assigned to Harvey Specter | Sees only Harvey's cases (Alpha + Beta); no access to Gamma |
| Vinny Gambini | Intern in M&A practice group | Assigned to Case Alpha; sees redacted content |

## Downstream Access Scope by Persona

This table defines the expected identity passthrough behavior for each persona across all downstream resource types. It serves as the ground truth for identity passthrough tests ([7.3.4](./7.3.4-identity-passthrough-tests.md)).

| Persona | Local DB (cases) | Local DB (billing) | Local DB (documents) | Graph Calendar | Graph SharePoint | Graph Mail |
|---|---|---|---|---|---|---|
| Harvey Specter (Partner) | Alpha, Beta (M&A) | Full access | All, including privileged | Own calendar, full R/W | M&A team site | Own mailbox |
| Kim Wexler (Associate) | Alpha only (assigned) | Own time entries | Assigned cases | Own calendar | Assigned case sites | Own mailbox |
| Alan Shore (OfCounsel) | Gamma only (Securities) | Own time entries | Own practice group | Own calendar | Securities team site | Own mailbox |
| Erin Brockovich (Paralegal) | Alpha only (assigned) | No access | Assigned cases | Assigned case events | Assigned case sites | Limited (no send) |
| Elle Woods (LegalAssistant) | Alpha, Beta (Harvey's cases) | View Harvey's entries | Harvey's cases | Harvey's calendar + own | Harvey's case sites | Own mailbox |
| Vinny Gambini (Intern) | Alpha (assigned, redacted) | No access | Assigned, redacted | Own schedule only | No access | Own mailbox |
