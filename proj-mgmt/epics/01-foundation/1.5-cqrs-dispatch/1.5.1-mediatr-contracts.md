# 1.5.1: Add MediatR and define command/query contracts

**Status:** DONE
**Type:** Story
**Feature:** [1.5: CQRS Dispatch Pattern for MCP Tools](./1.5-cqrs-dispatch.md)
**Tags:** `+architecture`, `+cqrs`
**ADR:** [ADR-008: CQRS dispatch pattern](../../../decisions/008-cqrs-dispatch-pattern.md)

---

As a developer building MCP tools,
I want a shared set of command/query contracts,
So that tools can dispatch operations without coupling to data source implementations.

- [x] Add `MediatR.Contracts` (v2.0.1) NuGet package to `LawCorp.Mcp.Core` (contracts only â€” `IRequest<T>`)
- [x] Add `MediatR` (v14.0.0) NuGet package to `LawCorp.Mcp.Server` (runtime registration)
- [x] Define query contracts in `LawCorp.Mcp.Core/Queries/`:
  - `SearchCasesQuery : IRequest<SearchCasesResult>`
  - `GetCaseByIdQuery : IRequest<GetCaseResult>`
  - `SearchDocumentsQuery : IRequest<SearchDocumentsResult>`
  - `GetDocumentByIdQuery : IRequest<GetDocumentResult>`
  - `ListDocumentsByCaseQuery : IRequest<SearchDocumentsResult>`
- [x] Define command contracts in `LawCorp.Mcp.Core/Commands/`:
  - `UpdateCaseStatusCommand : IRequest<CommandResult>`
- [x] Define result types alongside contracts (records)
- [x] Register MediatR in `ServerBootstrap.RegisterSharedServices()` DI configuration

## Acceptance Criteria

- [x] `MediatR.Contracts` package referenced in `LawCorp.Mcp.Core` and `MediatR` in `LawCorp.Mcp.Server`
- [x] 5 query contracts and 1 command contract defined
- [x] Contracts use `IRequest<T>` and carry all parameters needed for the operation
- [x] Result types are defined (records, not raw strings or `object`)
- [x] MediatR is registered in DI and resolves handlers at runtime

## Notes

Contracts live in `LawCorp.Mcp.Core` so both the server project (dispatching) and the handlers project (implementing) can reference them without circular dependencies.
