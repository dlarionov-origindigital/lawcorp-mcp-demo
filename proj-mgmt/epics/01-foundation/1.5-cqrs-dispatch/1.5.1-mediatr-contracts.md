# 1.5.1: Add MediatR and define command/query contracts

**Status:** BACKLOG
**Type:** Story
**Feature:** [1.5: CQRS Dispatch Pattern for MCP Tools](./1.5-cqrs-dispatch.md)
**Tags:** `+architecture`, `+cqrs`
**ADR:** [ADR-008: CQRS dispatch pattern](../../../decisions/008-cqrs-dispatch-pattern.md)

---

As a developer building MCP tools,
I want a shared set of command/query contracts,
So that tools can dispatch operations without coupling to data source implementations.

- [ ] Add `MediatR` NuGet package to `LawCorp.Mcp.Core` (contracts only â€” `IRequest<T>`, `INotification`)
- [ ] Add `MediatR` NuGet package to `LawCorp.Mcp.Server` (runtime registration)
- [ ] Define initial query contracts in `LawCorp.Mcp.Core/Queries/`:
  - `SearchCasesQuery : IRequest<SearchCasesResult>`
  - `GetCaseByIdQuery : IRequest<CaseResult>`
  - `SearchDocumentsQuery : IRequest<SearchDocumentsResult>`
- [ ] Define initial command contracts in `LawCorp.Mcp.Core/Commands/`:
  - `CreateDocumentCommand : IRequest<CreateDocumentResult>`
- [ ] Define result types alongside contracts (records or DTOs)
- [ ] Register MediatR in the MCP server's `Program.cs` / DI configuration

## Acceptance Criteria

- [ ] `MediatR` package referenced in `LawCorp.Mcp.Core` and `LawCorp.Mcp.Server`
- [ ] At least 3 query contracts and 1 command contract defined
- [ ] Contracts use `IRequest<T>` and carry all parameters needed for the operation
- [ ] Result types are defined (not raw strings or `object`)
- [ ] MediatR is registered in DI and resolves handlers at runtime

## Notes

Contracts live in `LawCorp.Mcp.Core` so both the server project (dispatching) and the handlers project (implementing) can reference them without circular dependencies.
