# 1.5.3: Refactor existing tools to dispatch via `IMediator`

**Status:** BACKLOG
**Type:** Story
**Feature:** [1.5: CQRS Dispatch Pattern for MCP Tools](./1.5-cqrs-dispatch.md)
**Tags:** `+architecture`, `+cqrs`

---

As a developer maintaining MCP tools,
I want tools to be thin dispatchers that send commands/queries via MediatR,
So that tools don't couple to data access implementation details.

- [ ] Refactor `SearchCases` tool to dispatch `SearchCasesQuery` via `IMediator.Send()`
- [ ] Refactor `GetCaseById` tool (or equivalent) to dispatch via `IMediator.Send()`
- [ ] Remove direct `DbContext` injection from refactored tools
- [ ] Inject `IMediator` in tool classes instead
- [ ] Verify existing tests still pass (if any)
- [ ] Document the before/after pattern as a migration guide for remaining tools

## Acceptance Criteria

- [ ] At least 2 tools refactored to use `IMediator` dispatch
- [ ] Refactored tools do not reference `DbContext`, `HttpClient`, or `IDownstreamTokenProvider` directly
- [ ] Tool output (MCP response content) is identical before and after refactoring
- [ ] Non-refactored tools continue to work as-is (no breaking changes)

## Notes

This is a proof-of-concept refactoring. Not all tools need to be migrated at once. The goal is to establish the pattern and verify it works end-to-end, then migrate remaining tools incrementally as they're built (Epic 3).
