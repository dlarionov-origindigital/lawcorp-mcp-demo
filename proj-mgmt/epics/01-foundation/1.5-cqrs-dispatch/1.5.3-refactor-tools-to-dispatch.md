# 1.5.3: Refactor existing tools to dispatch via `IMediator`

**Status:** DONE
**Type:** Story
**Feature:** [1.5: CQRS Dispatch Pattern for MCP Tools](./1.5-cqrs-dispatch.md)
**Tags:** `+architecture`, `+cqrs`

---

As a developer maintaining MCP tools,
I want tools to be thin dispatchers that send commands/queries via MediatR,
So that tools don't couple to data access implementation details.

- [x] Refactor `CasesSearch` tool to dispatch `SearchCasesQuery` via `IMediator.Send()`
- [x] Refactor `CasesGet` tool to dispatch `GetCaseByIdQuery` via `IMediator.Send()`
- [x] Refactor `CasesUpdateStatus` tool to dispatch `UpdateCaseStatusCommand` via `IMediator.Send()`
- [x] Refactor `DocumentsSearch` tool to dispatch `SearchDocumentsQuery` via `IMediator.Send()`
- [x] Refactor `DocumentsGet` tool to dispatch `GetDocumentByIdQuery` via `IMediator.Send()`
- [x] Refactor `DocumentsListByCase` tool to dispatch `ListDocumentsByCaseQuery` via `IMediator.Send()`
- [x] Remove direct `DbContext` and `IUserContext` injection from refactored tools
- [x] Inject `IMediator` in tool classes instead
- [ ] Remaining stubs (`AssignUser`, `GetTimeline`, `AddNote`, `Draft`, `UpdateStatus`) pending migration

## Acceptance Criteria

- [x] 6 tools refactored to use `IMediator` dispatch (3 case tools + 3 document tools)
- [x] Refactored tools do not reference `DbContext`, `HttpClient`, or `IDownstreamTokenProvider` directly
- [x] Tool output (MCP response content) is identical before and after refactoring
- [x] Non-refactored tools continue to work as-is (stubs throw `NotImplementedException`)

## Notes

This is a proof-of-concept refactoring. Not all tools need to be migrated at once. The goal is to establish the pattern and verify it works end-to-end, then migrate remaining tools incrementally as they're built (Epic 3).
