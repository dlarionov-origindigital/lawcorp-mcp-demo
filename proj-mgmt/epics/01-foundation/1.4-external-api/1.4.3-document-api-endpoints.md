# 1.4.3: Implement document API endpoints with OBO token validation

**Status:** BACKLOG
**Type:** Story
**Feature:** [1.4: External Downstream API Service](./1.4-external-api.md)
**Tags:** `+auth`, `+api`

---

As a Law-Corp attorney invoking MCP document tools,
I want the external API to return only documents I'm authorized to see,
So that multi-hop OBO identity delegation is enforced end-to-end.

The external API simulates a document management system (like iManage or NetDocuments). It exposes a REST API for case documents and enforces its own authorization based on the user identity in the OBO token.

- [ ] Implement `GET /api/documents?caseId={id}` — list documents for a case (user must have access)
- [ ] Implement `GET /api/documents/{id}` — get a single document (user must have access)
- [ ] Implement `GET /api/documents/{id}/content` — get document content/metadata
- [ ] Implement `POST /api/documents` — create a document on a case (requires `data.write` scope)
- [ ] Implement authorization logic: extract user identity from OBO token claims, enforce access based on case assignments
- [ ] Return 403 when the user's identity does not have access to the requested case/document

## Acceptance Criteria

- [ ] All endpoints require a valid OBO token (401 for missing/invalid tokens)
- [ ] Document results are scoped to the user's authorized cases (same logic as MCP server's case access)
- [ ] `POST` requires the `data.write` scope in the token's `scp` claim
- [ ] A Partner can see all documents; an Intern sees only assigned case documents with redacted privileged content
- [ ] 403 response includes a structured error body

## Dependencies

- 1.4.1 (project creation)
- 1.4.2 (app registration)

## Notes

The external API shares `LawCorp.Mcp.Data` for data access. In production, this would be a separate database. The shared data model lets us verify that the same user sees the same filtered data whether accessed via MCP server (local DB path) or external API (OBO path).
