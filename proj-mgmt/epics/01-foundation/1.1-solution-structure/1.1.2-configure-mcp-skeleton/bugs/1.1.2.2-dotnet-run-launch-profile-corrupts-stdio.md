# 1.1.2.2: `dotnet run` launch profile message corrupts stdio JSON-RPC stream

**Status:** DONE
**Type:** Bug
**Feature:** [1.1: Solution & Project Structure](../../1.1-solution-structure.md)
**Feature Item:** [1.1.2: Configure MCP server skeleton](../1.1.2-configure-mcp-skeleton.md)
**Related Epic:** [Epic 1: Foundation & Infrastructure](../../_epic.md)
**Tags:** `+foundation`, `+severity:high`, `+mcp-transport`, `+stdio`

---

## Problem

**Expected:** MCP Inspector (and other stdio MCP clients) connects to the server and completes the JSON-RPC initialization handshake.

**Actual:** The Inspector fails repeatedly with:

```
SyntaxError: Unexpected token 'U', "Using laun"... is not valid JSON
```

The MCP client never connects. The error repeats on every reconnect attempt.

**Reproduces:**

1. Ensure `Properties/launchSettings.json` exists in the server project (it does — created by task 1.1.3).
2. Run:
   ```bash
   npx @modelcontextprotocol/inspector dotnet run --project src/LawCorp.Mcp.Server
   ```
3. Observe the `SyntaxError` in the Inspector's server output pane.
4. Repeat with `--no-launch-profile`:
   ```bash
   npx @modelcontextprotocol/inspector dotnet run --no-launch-profile --project src/LawCorp.Mcp.Server
   ```
5. Inspector connects successfully.

**Severity:** High

**Impact:** The MCP Inspector, Claude Desktop, VS Code Copilot, Cursor, and any other stdio-based MCP client **cannot connect** to the server when launched via `dotnet run` without `--no-launch-profile`. This blocks all local development testing via stdio MCP clients.

---

## Root Cause

When `Properties/launchSettings.json` exists, `dotnet run` prints an informational message to **stdout**:

```
Using launch settings from Properties/launchSettings.json...
```

The MCP stdio transport expects **only** JSON-RPC messages on stdout. The `"Using laun..."` text is not valid JSON, so the client's `deserializeMessage()` throws a `SyntaxError` when it tries to `JSON.parse()` the line.

The .NET MCP SDK correctly routes all application logs to stderr (via the `LogToStandardErrorThreshold = LogLevel.Trace` configuration in `Program.cs`). However, this `dotnet run` message comes from the .NET CLI itself, not from the application — the SDK has no control over it.

Visual Studio is unaffected because it launches the compiled exe directly (`LawCorp.Mcp.Server.exe`), bypassing `dotnet run` entirely.

---

## Solution

### Changes Made

- **All `dotnet run` commands** across the repo now include `--no-launch-profile`:
  - `docs/local-dev.md` — all Inspector, Claude Desktop, VS Code, Claude Code, and verification commands
  - `docs/mcp.json` — the repo-level MCP client config
  - `readme.md` — Quick Start section
  - `src/README.md` — Run the server section
- **Troubleshooting entry** added to `docs/local-dev.md` describing the symptom and fix.

### Why Not Delete `launchSettings.json`?

The `launchSettings.json` is useful for Visual Studio developers — it configures the `DOTNET_ENVIRONMENT` variable for Development and Production profiles. Deleting it would remove that convenience. The `--no-launch-profile` flag is a targeted fix that only affects CLI usage.

---

## Acceptance Criteria

- [x] MCP Inspector connects successfully with `--no-launch-profile`
- [x] All `dotnet run` commands in docs include `--no-launch-profile`
- [x] Troubleshooting entry in `docs/local-dev.md` documents the symptom and fix
- [x] Visual Studio F5 debugging still works (unaffected)

---

## Notes

- This is a well-known pitfall with .NET stdio servers. The `dotnet run` CLI was not designed with stdio protocol servers in mind — it assumes stdout is for human-readable output.
- An alternative mitigation (not applied) would be to delete `launchSettings.json` and set `DOTNET_ENVIRONMENT` via other means (e.g., `appsettings` or env vars). This was rejected because `launchSettings.json` is standard Visual Studio tooling.
- Related: bug [1.1.2.1](./1.1.2.1-content-root-wrong-when-exe-launched-outside-project-dir.md) — another subprocess-launch issue (content root path).
