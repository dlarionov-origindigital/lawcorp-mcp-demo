# 1.2.4.2: SharePoint document access via user identity

**Status:** BACKLOG
**Type:** Task
**Story:** [1.2.4: Downstream resource access](./1.2.4-downstream-resource-access.md)
**Tags:** `+auth` `+foundation`

---

Implement a service that reads and lists SharePoint documents using the calling user's delegated identity, demonstrating that the MCP server accesses only files the user has permission to see in SharePoint.

## Implementation Steps

- [ ] Create `ISharePointService` interface in `LawCorp.Mcp.Core` with methods for listing site contents, reading document metadata, and downloading document content
- [ ] Implement `GraphSharePointService : ISharePointService` in `LawCorp.Mcp.Server` using `GraphServiceClient` (from 1.2.4.1) to call `/sites/{siteId}/drive/items` and related endpoints
- [ ] Required Graph scopes: `Sites.Read.All` (or more granular `Sites.Selected` if available)
- [ ] Register `ISharePointService` as scoped in DI
- [ ] Wire into the `documents_get` and `documents_search` MCP tools (Epic 3) as an alternative or supplemental document source beyond the local DB

## Acceptance Criteria

- [ ] A user who has SharePoint access to a site can list and read documents from that site via MCP tools
- [ ] A user who does not have SharePoint access to a site receives a structured permission-denied response (not an unhandled Graph exception)
- [ ] The service uses the user's OBO token, not a service account — SharePoint enforces the user's native permissions

## Persona Verification

| Persona | Expected Behavior |
|---|---|
| Harvey Specter (Partner) | Can access M&A team site documents |
| Vinny Gambini (Intern) | Cannot access restricted SharePoint sites; receives structured denial |

## Notes

Depends on 1.2.4.1 (Graph client with OBO provider).
The exact SharePoint site structure is TBD — for the reference architecture, a single demo site with varying permissions is sufficient.
