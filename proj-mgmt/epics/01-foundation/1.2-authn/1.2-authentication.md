# 1.2: Authentication â€” Microsoft Entra ID

**Status:** IN PROGRESS
**Epic:** [Epic 1: Project Foundation & Infrastructure](../_epic.md)
**Goal:** Implement Microsoft Entra ID authentication middleware with OBO token exchange for downstream service access, using OAuth identity passthrough as the canonical user-delegated access pattern ([ADR-005](../../decisions/005-oauth-identity-passthrough.md)). The OBO flow must support both Microsoft Graph and the custom external API ([Feature 1.4](../1.4-external-api/1.4-external-api.md)).
**Setup Guide:** [`docs/auth-config.md`](../../../../docs/auth-config.md)

## Items

| ID | Title | Type | Status |
|---|---|---|---|
| [1.2.1](./1.2.1-entra-id-auth-middleware.md) | Implement Entra ID authentication middleware | Story | IN PROGRESS |
| [1.2.2](./1.2.2-obo-token-exchange.md) | Implement On-Behalf-Of (OBO) token exchange | Story | IN PROGRESS |
| [1.2.3](./1.2.3-app-registrations-docs/1.2.3-app-registrations-docs.md) | Set up Entra ID app registrations documentation | Task | IN PROGRESS |
| [1.2.4](../1.1-solution-structure/1.2.4-downstream-resource-access/1.2.4-downstream-resource-access.md) | Downstream resource access via identity passthrough | Story | IN PROGRESS |

## Acceptance Criteria

- [ ] Valid Entra ID tokens are accepted
- [ ] Invalid/expired tokens return 401
- [ ] Claims are available in HttpContext for downstream use
- [ ] OBO flow passes caller identity to downstream services (Graph, external API)
- [ ] OBO flow supports multiple downstream APIs with distinct `api://` scopes
- [ ] Local database access is scoped by the user's identity context
- [ ] Consent flow errors are surfaced as structured MCP responses
- [ ] Three app registrations documented and tested (MCP Server, Web App, External API)
- [ ] Each persona role produces different access results for Graph, external API, and local DB resources
